{% extends "_base.htm" %}

{% block title %}
	New Scenario!
{% endblock%}

{% block bodycontent %}


<body data-spy="scroll" data-target=".navbar" data-offset="120">
    <!-- Navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <p class="navbar-text">Medication Task</p> 
            </div>
        </div>
    </nav>
    
    <div id="containerDiv" style="width:700px; display: none" class="container well">
		<h2>New Scenario!</h2>
		
		<p>Well done! You earned <span name="bonusSpan">bonusAmount</span> in bonuses from that round. Now we will start a new round. You will see your bonus amount reset to $1.00 for the second round, but your <b>final bonus</b> will be determined by adding your bonus from the first round (<span name="bonusSpan">bonusAmount</span>) to the amount you earn in this round.

		<p>You will now see data from <b>48 new patients</b> being treated for a different disease: <span id="diseaseName">Disease 2</span>, which is <b><span id="freq1">often</span> treated with <span id="drugA">drug A</span>, but is <span id="freq2">sometimes</span> treated with <span id="drugB">drug B</span></b>. Most patients have <span id="outcome"></span> treatment outcomes for this disease. Click below to begin. 
		
		<form id="submitForm" method="get" action="/scenario">
	    	<button style="width:100px" onclick="main.mySubmit()">Next</button>
	    	<input type="submit" value="" class="hidden"/>
		</form>

		
	</div>

</body>

<script>



// need to tell them what their current bonus amount is, and that their current amount will be added to the amount from the second scenario at the end

$(document).ready(function(){

	var main = {
		init: function(){
			main.bonus = {{bonus}}
			main.disease = '{{disease}}'

			main.position = {{position}}
			console.log(main.position)
			main.freqArrange()

			main.drugNames = ['XF702', 'BT339', 'GS596', 'PR242']
	        main.drugs = {{drugs}}

	        main.drugA_Name = String(main.drugNames[main.drugs[0]])
	        main.drugB_Name = String(main.drugNames[main.drugs[1]])

			main.cacheDOM()
			main.render()
		},
		
		cacheDOM: function(){
			main.$co = $('#containerDiv')
			main.$diseaseName = $('#diseaseName')
			main.$drugA = $('#drugA')
			main.$drugB = $('#drugB')
			main.$bonusSpans = main.$co.find('span[name=bonusSpan]')
		},
		render: function(){
			main.$bonusSpans.text('$'+main.creditRender(main.bonus))
			main.$diseaseName.text(main.disease)
			main.$drugA.text(main.drugA_Name)
			main.$drugB.text(main.drugB_Name)

			if('{{condition}}' == 'negative'){
				$('#outcome').text('GOOD')
			}else{
				$('#outcome').text('BAD')
			}

			main.$co.show()
		},
		creditRender: function(credits){
		    // display credits div
		    if(credits % 100 == 0){
		        var displayCredits = String(credits/100) + '.00';
		    }else if(credits %10 == 0){
		        displayCredits = String(credits/100) +'0'; 
		    }else{
		        displayCredits = credits/100;
		    }
		    return(displayCredits);
		    // $creditSpan.html(displayCredits);
		},

		mySubmit: function(){
			$('#submitForm').submit()
		},

		freqArrange: function(){
			if(main.position == 1){
				$('#freq1').text('sometimes')
				$('#freq2').text('more often')
			}
		}


	}



	main.init()
})
</script>


{% endblock %}
